
<!DOCTYPE html>
<html>
  <head>
    <link type="text/css" rel="stylesheet" href="/styles/style.css"/>
    <style type="text/css">

#states path {
  fill: rgb(100,100,100);
  stroke: rgb(100,100,100);
}

path.arc {
  pointer-events: none;
  fill: none;
  stroke: #000;
  display: none;
}

path.cell {
  fill: none;
  pointer-events: all;
}

circle {
  fill-opacity: .5;
}

#cells.voronoi path.cell {
  stroke: brown;
}

#cells g:hover path.arc {
  display: inherit;
}

    </style>
  </head>
  <body>

    <script type="text/javascript" src="/scripts/d3.v2.min.js"></script>
    <script type="text/javascript" src="/scripts/d3.csv.js"></script>
    <script type="text/javascript" src="/scripts/d3.geo.js"></script>
    <script type="text/javascript" src="/scripts/d3.geom.js"></script>
    <script type="text/javascript">

var width = screen.width,
    height = screen.height,
    centered;

var projection = d3.geo.azimuthal()
    .mode("equidistant")
    .origin([-98, 38])
    .scale(1400)
    .translate([width/2, height/2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").insert("svg:svg", "h2")
    .attr("width", width)
    .attr("height", height);

var states = svg.append("svg:g")
    .attr("id", "states");

var circles = svg.append("svg:g")
    .attr("id", "circles");

var cells = svg.append("svg:g")
    .attr("id", "cells");

d3.select("input[type=checkbox]").on("change", function() {
  cells.classed("voronoi", this.checked);
});

d3.json("px/us-states.json", function(collection) {
  states.selectAll("path")
      .data(collection.features)
    .enter().append("svg:path")
      .attr("d", path)
      .on("click", click);
});

function Tweet (color,position,text) {
    this.color = color;
    this.color = "red"
   	this.position = position
   	this.text = text
}

d3.csv("data/flights-airport.csv", function(flights) {
	
	
  var tweets = [];

  d3.csv("data/airports.csv", function(airports) {

    airports = airports.filter(function(airport) {
        var location = [+airport.longitude, +airport.latitude];
        tweets.push(new Tweet("#FFFFFF",projection(location),"HI"));
        return true;
    });
 /*   // Compute the Voronoi diagram of airports' projected positions.
    var polygons = d3.geom.voronoi(positions);

    var g = cells.selectAll("g")
        .data(airports)
      .enter().append("svg:g");

    g.append("svg:path")
        .attr("class", "cell")
        .attr("d", function(d, i) { return "M" + polygons[i].join("L") + "Z"; })
        .on("mouseover", function(d, i) { d3.select("h2 span").text(d.name); });

    g.selectAll("path.arc")
        .data(function(d) { return linksByOrigin[d.iata] || []; })
      .enter().append("svg:path")
        .attr("class", "arc")
        .attr("d", function(d) { return path(arc(d)); });
*/
    circles.selectAll("circle")
        .data(airports)
      .enter().append("svg:circle")
        .attr("cx", function(d, i) { return tweets[i].position[0]; })
        .attr("cy", function(d, i) { return tweets[i].position[1]; })
        .attr("r", function(d, i) { return 30; })
        .attr("fill",function(d, i) { return tweets[i].color; });
  });
});


function click(d) {
  var x = 0,
      y = 0,
      k = 1;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = -centroid[0];
    y = -centroid[1];
    k = 4;
    centered = d;
  } else {
    centered = null;
  }

  states.transition()
      .duration(1000)
      .attr("transform", "scale(" + k + ")translate(" + x + "," + y + ")")
      .style("stroke-width", 1.5 / k + "px");
}


    </script>
  </body>
</html>
